<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Search Test</title>	
	
	<script src="js/jquery.js"></script>
	<script src="js/utility/porterstemmer.js"></script>
	<script src="js/bible/bible.js"></script>
	<script src="js/bible/bible.formatter.js"></script>
	<script src="js/bible/bible.search.js"></script>
	
	<style>
	html, body {
		margin: 0;
	}
	#header, #footer {
		padding: 10px;
	}
	#content {
		overflow: auto;
		background: #eee;
	}
	
	#results {
		padding: 20px;
	}
	
	.highlight {
		background: yellow;
		
	}
	
	.search-result {
		overflow: hidden;
		margin: 0 0 10px 0;	
	}
	
	.search-result .verse {
		display: block	;
		float: left;
		width: 400px;
	}
	
	
	.search-result .search-verse {
		display: block;
		font-weight: bold;
		float: left;
		width: 90px;
	}
	
	.search-result .verse-num {
		display:none;
	}
	
	#search-status-bar {
		width: 300px;
		height: 10px;
		border: solid 1px #000;
		background: #fff;
	}
	
	#search-status-progress {
		width: 0;
		height: 10px;
		background: #0f0;
	}
	
	</style>
</head>
<body>	
	<div id="header">
		<h1>Search Test</h1>
		
		<p>Load and search</p>
	
		<!--
		<table>
			<thead>
				<tr><th>action</th><th>Safari</th><th>Firefox</th><th>IE9 (VM)</tr>
			</head>
			<tbody>
				<tr><td>load</td><td>3</td><td>5</td><td>3.2</td></tr>
				<tr><td>load, $(data)</td><td>5</td><td>9.6</td><td>13.3</td></tr>
				<tr><td>load, $(data), span.verse:content('light')</td><td>5.8</td><td>10.5</td><td>13.8</td></tr>
				<tr><td>load, $(data), span.verse:content('light'), append</td><td>7.3</td><td>14.9</td><td>14.4</td></tr>
				<tr><td>load, $(data), span.verse:content('light'), format, append</td><td>7.4</td><td>11.7</td><td>15.1</td></tr>
				<tr><td>load, $(data), span.verse, regex, format, append</td><td>9.2</td><td>16.9</td><td>24</td></tr>
			</tbody>
		</table>
		-->
		
		<input type="text" id="search" placeholder="Paul, Jesus, etc." />
		<input type="button" id="search-button" value="Search" />
		<input type="button" id="cancel-button" value="Cancel" />
		<input type="checkbox" id="show-feedback" /><label for="show-feedback">Show Feedback</label>
		
		<div id="search-status-bar">
			<div id="search-status-progress"></div>
		</div>
		
		<span id="status">&nbsp;
		</span>	
	
	</div>
	<div id="content">
	

		
		<div id="results">
			
		</div>
	
	
	</div>
	<div id="footer">
		<p>Copyright</p>
	</div>
	
<script>
jQuery(function($) {
	
	
	// WINDOW size
	
	function resize() {
		var footerHeight = $('#footer').outerHeight(true),
			headerHeight = $('#header').outerHeight(true),
			windowHeight = $(window).height();
		
		$('#content').height(windowHeight - footerHeight - headerHeight );
		
	}
	resize();
	$(window).resize(resize);
	
	
	// SEARCH code
	
	var status = $('#status'),
		results = $('#results'),
		searchButton = $('#search-button').prop('disabled', false)	,
		cancelButton = $('#cancel-button'),
		searchText = $('#search'),
		showFeedbackCheckbox = $('#show-feedback'),
		
		searchBar = $('#search-status-bar'),
		searchProgress = $('#search-status-progress');
	
	searchButton.click(function() {
		
		searchButton.prop('disabled', true);
		searchText.prop('disbled', true);
		
		var sbw = searchBar.width(),
			showFeedback = showFeedbackCheckbox.is(':checked');
				
		bible.BibleSearch.search( searchText.val(), 'en_kjv',
			
			// chapter progress
			function(bookIndex, chapterIndex, resultsCount, startDate) {
				
				if (showFeedback) {
					status.html('found: ' + resultsCount + '; time: ' + ((	new Date() - startDate)/1000) + '; searching: ' + bible.Books[ bookIndex ].names[0] + ' ' + (chapterIndex+1).toString() )
					searchProgress.width( (bookIndex+1)/66 * sbw );
				}
				
			},
			
			// ended
			function(resultHtml, resultsCount, startDate) {
				
				results.html(resultHtml);
				
				status.html('found: ' + resultsCount + '; time: ' + ((	new Date() - startDate)/1000) + '');
				
				searchButton.prop('disabled', false);
				searchText.prop('disbled', false);	
			}
		);
	});
	
	cancelButton.click(function() {
		
		bible.BibleSearch.cancelSearch();
		
		searchButton.prop('disabled', false);
		searchText.prop('disbled', false);
		
	});	
	
});

</script>
</body>
</html>